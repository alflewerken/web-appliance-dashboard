/* Mobile Panel Safe Area Support */

/* Base panel adjustments for mobile */
@media (max-width: 768px) {
  /* Panel containers need to respect viewport width */
  .panel-container {
    /* Use 100vw to ensure full width */
    width: 100vw !important;
    max-width: 100vw !important;
    /* Position from edges */
    left: 0 !important;
    right: 0 !important;
    /* Prevent horizontal overflow */
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }

  /* Direct child of panel should handle safe areas */
  .panel-container > * {
    box-sizing: border-box !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Service Panel Mobile Adjustments */
  .service-panel {
    /* Safe areas handled internally, not on container */
    width: 100% !important;
    box-sizing: border-box !important;
  }

  .service-panel-header {
    /* Add safe area padding to header */
    padding-top: calc(16px + env(safe-area-inset-top, 0));
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
    box-sizing: border-box !important;
  }

  .service-panel-content {
    /* Ensure content respects safe areas */
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
    padding-bottom: calc(20px + env(safe-area-inset-bottom, 0));
  }

  /* Settings Panel Mobile Adjustments */
  .settings-panel {
    padding-left: env(safe-area-inset-left, 0) !important;
    padding-right: env(safe-area-inset-right, 0) !important;
  }

  .settings-header {
    padding-top: calc(16px + env(safe-area-inset-top, 0));
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
  }

  .settings-content {
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
    padding-bottom: calc(20px + env(safe-area-inset-bottom, 0));
  }

  /* User Panel Mobile Adjustments */
  .user-panel {
    padding-left: env(safe-area-inset-left, 0) !important;
    padding-right: env(safe-area-inset-right, 0) !important;
  }

  .user-panel-header {
    padding-top: calc(16px + env(safe-area-inset-top, 0));
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
  }

  .user-panel-content {
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
    padding-bottom: calc(20px + env(safe-area-inset-bottom, 0));
  }

  /* Audit Log Panel Mobile Adjustments */
  .audit-log-panel {
    padding-left: env(safe-area-inset-left, 0) !important;
    padding-right: env(safe-area-inset-right, 0) !important;
  }

  .audit-log-header {
    padding-top: calc(16px + env(safe-area-inset-top, 0));
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
  }

  .audit-log-content {
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
    padding-bottom: calc(20px + env(safe-area-inset-bottom, 0));
  }

  /* Ensure tab bars respect safe areas */
  .panel-tabs {
    padding-left: calc(16px + env(safe-area-inset-left, 0));
    padding-right: calc(16px + env(safe-area-inset-right, 0));
  }

  /* Fix for panel resize handles on mobile - should be disabled */
  .resize-handle {
    display: none !important;
  }

  /* Ensure modals within panels also respect safe areas */
  .panel-container .modal-content {
    margin-left: env(safe-area-inset-left, 0);
    margin-right: env(safe-area-inset-right, 0);
    margin-bottom: env(safe-area-inset-bottom, 0);
  }

  /* Full-screen panel overlay for mobile */
  .panel-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1299;
    display: none;
  }

  .music-app.has-service-panel .panel-overlay,
  .music-app.has-user-panel .panel-overlay,
  .music-app.has-settings-panel .panel-overlay,
  .music-app.has-audit-log-panel .panel-overlay {
    display: block;
  }
}

/* iOS specific adjustments */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    .panel-container {
      /* Use 100% of viewport height accounting for iOS bars */
      height: 100vh;
      height: -webkit-fill-available;
      height: 100dvh; /* Dynamic viewport height */
    }

    /* Ensure scrollable areas work properly */
    .panel-content {
      height: calc(100% - 60px); /* Account for header */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }
  }
}

/* Landscape orientation adjustments */
@media (max-width: 768px) and (orientation: landscape) {
  .panel-container {
    /* In landscape, safe areas are typically on the sides */
    padding-left: calc(20px + env(safe-area-inset-left, 0));
    padding-right: calc(20px + env(safe-area-inset-right, 0));
  }
}

/* Handle notch and home indicator on newer iPhones */
@media (max-width: 768px) {
  /* iPhone X and later */
  @supports (padding: max(0px)) {
    .panel-container {
      /* Use max() to ensure minimum padding even without safe areas */
      padding-left: max(0px, env(safe-area-inset-left));
      padding-right: max(0px, env(safe-area-inset-right));
      padding-top: max(0px, env(safe-area-inset-top));
      padding-bottom: max(0px, env(safe-area-inset-bottom));
    }

    .panel-header {
      padding-top: max(16px, calc(16px + env(safe-area-inset-top)));
    }

    .panel-content {
      padding-bottom: max(20px, calc(20px + env(safe-area-inset-bottom)));
    }
  }
}
