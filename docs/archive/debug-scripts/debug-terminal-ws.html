<!DOCTYPE html>
<html>
<head>
    <title>Terminal WebSocket Debug</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        #log {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            height: 400px;
            overflow-y: auto;
        }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #339af0; }
        button {
            background: #339af0;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #1c7ed6;
        }
        input {
            padding: 8px;
            width: 300px;
            margin: 5px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>Terminal WebSocket Debug</h1>
    
    <div>
        <input type="text" id="token" placeholder="Auth Token (optional for test)">
        <button onclick="testWebSocket()">Test WebSocket Connection</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="log"></div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            log.innerHTML = '';
        }
        
        function testWebSocket() {
            addLog('Starting WebSocket test...', 'info');
            
            const token = document.getElementById('token').value || 'test-token';
            const wsUrl = `ws://localhost:9081/api/terminal-session`;
            
            addLog(`Connecting to: ${wsUrl}`, 'info');
            
            try {
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    addLog('WebSocket connected!', 'success');
                    addLog('Sending init message...', 'info');
                    
                    const initMessage = {
                        type: 'init',
                        authToken: token,
                        applianceId: 1
                    };
                    
                    ws.send(JSON.stringify(initMessage));
                    addLog(`Sent: ${JSON.stringify(initMessage)}`, 'info');
                };
                
                ws.onmessage = (event) => {
                    addLog(`Received: ${event.data}`, 'success');
                };
                
                ws.onerror = (error) => {
                    addLog(`WebSocket error: ${error}`, 'error');
                    console.error('WebSocket error:', error);
                };
                
                ws.onclose = (event) => {
                    addLog(`WebSocket closed - Code: ${event.code}, Reason: ${event.reason}`, 'error');
                };
                
            } catch (error) {
                addLog(`Failed to create WebSocket: ${error.message}`, 'error');
            }
        }
        
        // Auto-test on load
        window.onload = () => {
            addLog('Page loaded. Click "Test WebSocket Connection" to start.', 'info');
        };
    </script>
</body>
</html>
