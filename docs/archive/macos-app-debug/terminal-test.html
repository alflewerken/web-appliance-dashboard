<!DOCTYPE html>
<html>
<head>
    <title>Terminal Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1e1e1e;
            color: white;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #005a9e;
        }
        .log {
            background: #2d2d2d;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Terminal Test Page</h1>
    
    <button onclick="testDirectOpen()">Test 1: Direct window.open</button>
    <button onclick="testElectronAPI()">Test 2: Electron API</button>
    <button onclick="testHandleTerminalOpen()">Test 3: handleTerminalOpen</button>
    <button onclick="testLocationHref()">Test 4: location.href</button>
    
    <div id="log" class="log">Log output will appear here...</div>

    <script>
        function log(msg) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toISOString() + ' - ' + msg + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function testDirectOpen() {
            log('Test 1: Trying direct window.open...');
            const url = 'http://localhost:7682/terminal/?host=host.docker.internal&user=alflewerken&port=22';
            log('URL: ' + url);
            
            try {
                const win = window.open(url, '_blank', 'width=1000,height=700');
                log('window.open result: ' + (win ? 'Success' : 'BLOCKED'));
            } catch (e) {
                log('Error: ' + e.message);
            }
        }

        function testElectronAPI() {
            log('Test 2: Checking Electron API...');
            
            if (window.electronAPI) {
                log('electronAPI found: ' + Object.keys(window.electronAPI).join(', '));
                
                if (window.electronAPI.terminal) {
                    log('terminal API found: ' + Object.keys(window.electronAPI.terminal).join(', '));
                    
                    try {
                        window.electronAPI.terminal.open({
                            hostname: 'host.docker.internal',
                            username: 'alflewerken',
                            port: 22
                        });
                        log('IPC call sent');
                    } catch (e) {
                        log('IPC error: ' + e.message);
                    }
                } else {
                    log('terminal API NOT found');
                }
            } else {
                log('electronAPI NOT found');
            }
        }

        function testHandleTerminalOpen() {
            log('Test 3: Testing handleTerminalOpen...');
            
            if (window.handleTerminalOpen) {
                log('handleTerminalOpen found');
                
                try {
                    window.handleTerminalOpen({
                        hostname: 'host.docker.internal',
                        username: 'alflewerken',
                        port: 22
                    });
                    log('handleTerminalOpen called');
                } catch (e) {
                    log('Error: ' + e.message);
                }
            } else {
                log('handleTerminalOpen NOT found');
            }
        }

        function testLocationHref() {
            log('Test 4: Using location.href (will navigate away)...');
            const url = 'http://localhost:7682/terminal/?host=host.docker.internal&user=alflewerken&port=22';
            
            if (confirm('This will navigate away from this page. Continue?')) {
                location.href = url;
            }
        }

        // Initial log
        log('Terminal Test Page loaded');
        log('User Agent: ' + navigator.userAgent);
        log('Electron detected: ' + (navigator.userAgent.includes('Electron') ? 'YES' : 'NO'));
    </script>
</body>
</html>
