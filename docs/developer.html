<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Appliance Dashboard - Developer Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #1a1a1a;
        }
        h1 {
            border-bottom: 3px solid #007AFF;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 40px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
        }
        .version-badge {
            background-color: #007AFF;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-left: 10px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .code-block {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .info-box {
            background: #e8f4f9;
            border-left: 4px solid #007AFF;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .toc {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .toc a {
            color: #007AFF;
            text-decoration: none;
        }
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#007AFF',
                primaryTextColor: '#fff',
                primaryBorderColor: '#0051D5',
                lineColor: '#333',
                secondaryColor: '#f0f0f0',
                tertiaryColor: '#fff'
            }
        });
    </script>
</head>
<body>
    <h1>Web Appliance Dashboard - Developer Documentation <span class="version-badge">v1.1.1</span></h1>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#overview">System Overview</a></li>
            <li><a href="#architecture">Architecture</a></li>
            <li><a href="#components">Components</a></li>
            <li><a href="#data-flow">Data Flow</a></li>
            <li><a href="#auth-flow">Authentication Flow</a></li>
            <li><a href="#ssh-architecture">SSH Architecture</a></li>
            <li><a href="#remote-desktop">Remote Desktop Integration</a></li>
            <li><a href="#deployment">Deployment Architecture</a></li>
            <li><a href="#security">Security Architecture</a></li>
            <li><a href="#api-structure">API Structure</a></li>
        </ul>
    </div>

    <h2 id="overview">System Overview</h2>
    <div class="info-box">
        <p>Web Appliance Dashboard is a containerized web application built with React (Frontend) and Node.js (Backend), 
        designed to manage and monitor web services, SSH connections, and remote desktop sessions.</p>
    </div>

    <h2 id="architecture">Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph TB
            subgraph "Client Layer"
                Browser[Web Browser]
                Mobile[Mobile Device]
            end
            
            subgraph "Proxy Layer"
                Nginx[Nginx Reverse Proxy<br/>Port 80/443]
            end
            
            subgraph "Application Layer"
                Frontend[React Frontend<br/>Port 3001]
                Backend[Node.js Backend<br/>Port 3000]
            end
            
            subgraph "Service Layer"
                TTYD[TTYD Terminal<br/>Port 7681]
                Guacamole[Apache Guacamole<br/>Port 9070]
                Guacd[Guacd Server<br/>Port 4822]
            end
            
            subgraph "Data Layer"
                MySQL[(MySQL Database<br/>Port 3306)]
                FileSystem[File System<br/>SSH Keys & Configs]
            end
            
            subgraph "External Services"
                SSH[SSH Hosts]
                VNC[VNC Servers]
                RDP[RDP Hosts]
                WebApps[Web Applications]
            end
            
            Browser --> Nginx
            Mobile --> Nginx
            Nginx --> Frontend
            Nginx --> Backend
            Nginx --> TTYD
            Nginx --> Guacamole
            
            Frontend -.->|API Calls| Backend
            Backend --> MySQL
            Backend --> FileSystem
            Backend --> SSH
            Backend --> WebApps
            
            Guacamole --> Guacd
            Guacd --> VNC
            Guacd --> RDP
            Guacd --> SSH
            
            TTYD --> SSH
            
            style Nginx fill:#e1f5fe
            style Frontend fill:#c5e1a5
            style Backend fill:#ffccbc
            style MySQL fill:#d1c4e9
            style Guacamole fill:#fff9c4        </div>
    </div>

    <h2 id="components">Components</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph LR
            subgraph "Frontend Components"
                App[App.js<br/>Main Component]
                Login[LoginForm]
                Dashboard[Dashboard]
                Sidebar[AppSidebar]
                AppCard[ApplianceCard]
                Terminal[TerminalModal]
                RemoteDesktop[RemoteDesktopButton]
                Settings[SettingsModal]
                UserMgmt[UserManagement]
                Backup[BackupTab]
                AuditLog[AuditLog]
            end
            
            subgraph "Services"
                AuthService[authService]
                ProxyService[proxyService]
                BackupService[backupService]
                SSHService[sshService]
            end
            
            subgraph "Hooks"
                useAppliances[useAppliances]
                useAuth[useAuth]
                useSSH[useSSH]
            end
            
            App --> Login
            App --> Dashboard
            Dashboard --> Sidebar
            Dashboard --> AppCard
            Dashboard --> Settings
            Dashboard --> UserMgmt
            Dashboard --> AuditLog
            
            AppCard --> Terminal
            AppCard --> RemoteDesktop
            
            Settings --> Backup
            
            Dashboard --> useAppliances
            Login --> AuthService
            Terminal --> SSHService
            Backup --> BackupService
            
            style App fill:#4CAF50
            style Dashboard fill:#2196F3
            style AuthService fill:#FF9800
            style useAppliances fill:#9C27B0
        </div>
    </div>

    <h2 id="data-flow">Data Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
        sequenceDiagram
            participant User
            participant Frontend
            participant Nginx
            participant Backend
            participant MySQL
            participant SSH Host
            
            User->>Frontend: Access Dashboard
            Frontend->>Backend: GET /api/appliances
            Backend->>MySQL: Query appliances
            MySQL-->>Backend: Return data
            Backend-->>Frontend: JSON response
            Frontend-->>User: Display appliances
            
            User->>Frontend: Click Terminal
            Frontend->>Backend: POST /api/ssh/execute
            Backend->>SSH Host: SSH Connection
            SSH Host-->>Backend: Command output
            Backend-->>Frontend: Stream response
            Frontend-->>User: Display output
            
            User->>Frontend: Access via Proxy
            Frontend->>Nginx: Proxy request
            Nginx->>Backend: Forward to /api/appliances/:id/proxy
            Backend->>SSH Host: Forward request
            SSH Host-->>Backend: Response
            Backend-->>Nginx: Proxy response
            Nginx-->>Frontend: Return response
            Frontend-->>User: Display content
        </div>
    </div>

    <h2 id="auth-flow">Authentication Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
        sequenceDiagram
            participant User
            participant Frontend
            participant Backend
            participant MySQL
            participant JWT
            
            User->>Frontend: Enter credentials
            Frontend->>Backend: POST /api/auth/login
            Backend->>MySQL: Verify user
            MySQL-->>Backend: User data
            Backend->>JWT: Generate token
            JWT-->>Backend: Token
            Backend-->>Frontend: Token + User info
            Frontend->>Frontend: Store in localStorage
            
            Note over Frontend: Subsequent requests
            
            Frontend->>Backend: API request + Bearer token
            Backend->>JWT: Verify token
            JWT-->>Backend: Valid/Invalid
            alt Token valid
                Backend->>MySQL: Process request
                MySQL-->>Backend: Data
                Backend-->>Frontend: Response
            else Token invalid
                Backend-->>Frontend: 401 Unauthorized
                Frontend->>User: Redirect to login
            end
        </div>
    </div>

    <h2 id="ssh-architecture">SSH Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph TB
            subgraph "SSH Management"
                SSHManager[SSH Manager<br/>routes/ssh.js]
                KeyGen[Key Generation]
                ConfigGen[Config Generation]
                HostMgmt[Host Management]
            end
            
            subgraph "Storage"
                KeyStore[SSH Keys<br/>/app/ssh-keys/]
                ConfigFile[SSH Config<br/>/app/.ssh/config]
                Database[(MySQL<br/>ssh_hosts table)]
            end
            
            subgraph "Execution"
                Terminal[Web Terminal<br/>TTYD]
                DirectSSH[Direct SSH<br/>node-ssh]
                FileUpload[File Upload<br/>scp]
            end
            
            SSHManager --> KeyGen
            SSHManager --> ConfigGen
            SSHManager --> HostMgmt
            
            KeyGen --> KeyStore
            ConfigGen --> ConfigFile
            HostMgmt --> Database
            
            Terminal --> ConfigFile
            DirectSSH --> KeyStore
            FileUpload --> KeyStore
            
            style SSHManager fill:#FF6B6B
            style KeyStore fill:#4ECDC4
            style Database fill:#45B7D1
        </div>
    </div>

    <h2 id="remote-desktop">Remote Desktop Integration</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph LR
            subgraph "Client"
                User[User Browser]
                RemoteBtn[Remote Desktop Button]
            end
            
            subgraph "Backend API"
                TokenAPI[GET /api/remote-desktop/token/:id]
                ConnMgmt[Connection Management]
                AuthToken[Token Generation]
            end
            
            subgraph "Guacamole Stack"
                GuacWeb[Guacamole Web<br/>Port 9070]
                GuacAPI[Guacamole API]
                Guacd[Guacd Server<br/>Port 4822]
            end
            
            subgraph "Remote Hosts"
                VNC[VNC Server<br/>Port 5900]
                RDP[RDP Host<br/>Port 3389]
                SSH2[SSH Server<br/>Port 22]
            end
            
            User --> RemoteBtn
            RemoteBtn --> TokenAPI
            TokenAPI --> ConnMgmt
            ConnMgmt --> AuthToken
            AuthToken --> GuacAPI
            
            User --> GuacWeb
            GuacWeb --> Guacd
            Guacd --> VNC
            Guacd --> RDP
            Guacd --> SSH2
            
            style GuacWeb fill:#FFA726
            style Guacd fill:#66BB6A
            style TokenAPI fill:#42A5F5
        </div>
    </div>

    <h2 id="deployment">Deployment Architecture</h2>    <div class="diagram-container">
        <div class="mermaid">
        graph TB
            subgraph "Docker Compose Stack"
                Network[Docker Network<br/>appliance_network]
                
                subgraph "Containers"
                    Web[webserver<br/>Nginx]
                    Front[frontend<br/>React Dev Server]
                    Back[backend<br/>Node.js]
                    DB[(database<br/>MySQL)]
                    Term[ttyd<br/>Web Terminal]
                    Guac[guacamole<br/>Tomcat]
                    GuacD[guacd<br/>RDP/VNC Proxy]
                end
                
                subgraph "Volumes"
                    AppData[appliance_data]
                    DBData[mysql_data]
                    SSHKeys[ssh_keys]
                    GuacData[guacamole_data]
                    Sessions[terminal_sessions]
                end
            end
            
            subgraph "Host System"
                Ports[Exposed Ports<br/>80, 443, 3306]
                EnvFile[.env Configuration]
                DockerEngine[Docker Engine]
            end
            
            Network --> Web
            Network --> Front
            Network --> Back
            Network --> DB
            Network --> Term
            Network --> Guac
            Network --> GuacD
            
            Back --> AppData
            Back --> SSHKeys
            DB --> DBData
            Guac --> GuacData
            Term --> Sessions
            
            DockerEngine --> Network
            EnvFile --> DockerEngine
            Ports --> Web
            
            style Network fill:#E1BEE7
            style Web fill:#BBDEFB
            style Back fill:#C8E6C9
            style DB fill:#FFE082
        </div>
    </div>

    <h2 id="security">Security Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph TB
            subgraph "Security Layers"
                subgraph "Network Security"
                    CORS[CORS Policy]
                    RateLimit[Rate Limiting]
                    Helmet[Helmet.js]
                end
                
                subgraph "Authentication"
                    JWT[JWT Tokens]
                    Sessions[Session Management]
                    RBAC[Role-Based Access]
                end
                
                subgraph "Data Security"
                    Encryption[AES-256 Encryption]
                    Hashing[bcrypt Hashing]
                    Sanitization[Input Sanitization]
                end
                
                subgraph "Access Control"
                    APIAuth[API Authentication]
                    ProxyAuth[Proxy Authorization]
                    FileAccess[File Access Control]
                end
            end
            
            subgraph "Threats Mitigated"
                XSS[XSS Attacks]
                CSRF[CSRF Attacks]
                SQLInj[SQL Injection]
                BruteForce[Brute Force]
                Unauth[Unauthorized Access]
            end
            
            CORS --> XSS
            CORS --> CSRF
            Helmet --> XSS
            RateLimit --> BruteForce
            JWT --> Unauth
            Sanitization --> SQLInj
            Encryption --> Unauth
            
            style CORS fill:#FFCDD2
            style JWT fill:#C5E1A5
            style Encryption fill:#B2DFDB
        </div>
    </div>

    <h2 id="api-structure">API Structure</h2>
    <div class="diagram-container">
        <div class="mermaid">
        graph LR
            subgraph "API Routes"
                Auth[/api/auth<br/>Authentication]
                Appliances[/api/appliances<br/>Service Management]
                SSH[/api/ssh<br/>SSH Operations]
                Remote[/api/remote-desktop<br/>Remote Access]
                Users[/api/users<br/>User Management]
                Backup[/api/backup<br/>Backup/Restore]
                Audit[/api/audit<br/>Audit Logging]
                Health[/api/health<br/>Health Check]
            end
            
            subgraph "Middleware"
                AuthMW[authenticateToken]
                AdminMW[requireAdmin]
                RateLimitMW[rateLimiter]
                ValidateMW[validateInput]
            end
            
            subgraph "Controllers"
                AuthCtrl[authController]
                AppCtrl[applianceController]
                SSHCtrl[sshController]
                UserCtrl[userController]
            end
            
            Auth --> AuthCtrl
            Appliances --> AuthMW
            Appliances --> AppCtrl
            SSH --> AuthMW
            SSH --> SSHCtrl
            Users --> AuthMW
            Users --> AdminMW
            Users --> UserCtrl
            
            style Auth fill:#FF7043
            style AuthMW fill:#5C6BC0
            style AuthCtrl fill:#26A69A
        </div>
    </div>

    <div class="info-box">
        <h3>Key Technologies</h3>
        <ul>
            <li><strong>Frontend:</strong> React 18.2, Material-UI, Axios</li>
            <li><strong>Backend:</strong> Node.js, Express, MySQL2, node-ssh</li>
            <li><strong>Security:</strong> JWT, bcrypt, Helmet.js, express-rate-limit</li>
            <li><strong>Infrastructure:</strong> Docker, Nginx, Apache Guacamole</li>
            <li><strong>Real-time:</strong> Server-Sent Events (SSE)</li>
        </ul>
    </div>

    <div class="warning-box">
        <h3>Development Notes</h3>
        <ul>
            <li>Always use <code>docker compose</code> for development</li>
            <li>Frontend runs in development mode with hot reload</li>
            <li>Backend uses nodemon for auto-restart</li>
            <li>MySQL data persists in Docker volumes</li>
            <li>SSH keys are stored encrypted in the filesystem</li>
        </ul>
    </div>

    <div class="code-block">
        <h3>Quick Start</h3>
        <pre>
# Clone repository
git clone https://github.com/your-repo/web-appliance-dashboard.git
cd web-appliance-dashboard

# Setup environment
./scripts/setup-env.sh

# Start all services
docker compose up -d

# Check status
docker compose ps

# View logs
docker compose logs -f backend
        </pre>
    </div>

    <div class="info-box">
        <p><strong>Version:</strong> 1.1.1<br>
        <strong>Last Updated:</strong> July 2025<br>
        <strong>License:</strong> MIT</p>
    </div>
</body>
</html>