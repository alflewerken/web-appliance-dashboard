<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal</title>
    <!-- TTYD Configuration Override - Eliminiert unnötige Fehler und Warnungen -->
    <script src="/js/ttyd-config.js"></script>
    <script>
        // URL-Parameter auslesen
        const urlParams = new URLSearchParams(window.location.search);
        
        // Host-Parameter korrigieren für Docker-Container
        let host = urlParams.get('host') || '';
        let user = urlParams.get('user') || '';
        let port = urlParams.get('port') || '22';
        const hostId = urlParams.get('hostId') || '';
        
        // Spezielle Behandlung für lokalen Mac-Zugriff
        if (host === 'mac' || host === 'localhost' || host === '127.0.0.1') {
            host = 'host.docker.internal';
        }
        
        // Erstelle ttyd URL mit Parametern
        const ttydParams = new URLSearchParams();
        if (host) ttydParams.append('host', host);
        if (user) ttydParams.append('user', user);
        if (port) ttydParams.append('port', port);
        if (hostId) ttydParams.append('hostId', hostId);
        
        // Bestimme die korrekte URL basierend auf dem aktuellen Protokoll
        let ttydUrl;
        const currentProtocol = window.location.protocol;
        const currentHost = window.location.hostname;
        
        // Wenn wir über HTTPS zugreifen, versuchen wir ttyd über einen relativen Pfad
        if (currentProtocol === 'https:') {
            // Versuche über nginx proxy (falls konfiguriert)
            ttydUrl = `/ttyd/?${ttydParams.toString()}`;
        } else {
            // Direkte Verbindung zu ttyd
            ttydUrl = `http://${currentHost}:7681/?${ttydParams.toString()}`;
        }
        
        // Debug-Information
        console.log('Current Protocol:', currentProtocol);
        console.log('Current Host:', currentHost);
        console.log('TTYd URL:', ttydUrl);
        
        // Erstelle die Seite mit Optionen
        document.addEventListener('DOMContentLoaded', function() {
            document.body.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #1e1e1e; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; padding: 20px; text-align: center;">
                    <h2 style="color: #4ecdc4; margin-bottom: 30px;">Terminal öffnen</h2>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 30px; max-width: 600px;">
                        <p style="margin-bottom: 20px;">Wählen Sie eine Option zum Öffnen des Terminals:</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <a href="${ttydUrl}" target="_blank" style="
                                display: inline-block;
                                padding: 15px 30px;
                                background: #4ecdc4;
                                color: #1e1e1e;
                                text-decoration: none;
                                border-radius: 5px;
                                font-weight: bold;
                                font-size: 16px;
                                transition: all 0.3s;
                            " onmouseover="this.style.background='#3dbdb5'" onmouseout="this.style.background='#4ecdc4'">
                                Terminal öffnen (empfohlen)
                            </a>
                            
                            ${currentProtocol === 'https:' ? `
                            <a href="http://${currentHost}:7681/?${ttydParams.toString()}" target="_blank" style="
                                display: inline-block;
                                padding: 15px 30px;
                                background: #666;
                                color: #fff;
                                text-decoration: none;
                                border-radius: 5px;
                                font-weight: bold;
                                font-size: 14px;
                                transition: all 0.3s;
                            " onmouseover="this.style.background='#777'" onmouseout="this.style.background='#666'">
                                Direkt über HTTP öffnen (Port 7681)
                            </a>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div style="color: #888; font-size: 14px; max-width: 600px;">
                        <p style="margin-bottom: 10px;"><strong>Hinweise:</strong></p>
                        <ul style="text-align: left; margin: 0; padding-left: 20px;">
                            <li>Falls das Terminal nicht lädt, stellen Sie sicher, dass die Docker-Container laufen</li>
                            <li>Bei HTTPS-Verbindungen kann es zu Mixed-Content-Warnungen kommen</li>
                            <li>Port 7681 muss für die direkte Verbindung erreichbar sein</li>
                        </ul>
                    </div>
                    
                    <button onclick="window.close()" style="
                        margin-top: 30px;
                        padding: 10px 20px;
                        background: transparent;
                        color: #888;
                        border: 1px solid #888;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.3s;
                    " onmouseover="this.style.borderColor='#aaa'; this.style.color='#aaa'" onmouseout="this.style.borderColor='#888'; this.style.color='#888'">
                        Fenster schließen
                    </button>
                </div>
            `;
        });
    </script>
</head>
<body style="margin: 0; background: #1e1e1e;">
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; color: #4ecdc4; font-family: Arial;">
        Lade Terminal-Optionen...
    </div>
</body>
</html>
