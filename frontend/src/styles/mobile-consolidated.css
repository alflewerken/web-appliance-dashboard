/**
 * Consolidated Mobile Styles for Web Appliance Dashboard
 * This file combines all mobile-specific styles into organized sections
 * Created: 2025-01-12
 */

/* ============================================
   1. BASE MOBILE SETTINGS & VIEWPORT FIXES
   ============================================ */

@media (max-width: 768px) {
  /* Prevent horizontal scrolling and ensure proper viewport behavior */
  html, body {
    overflow-x: hidden !important;
    width: 100% !important;
    position: relative !important;
  }

  /* Global box-sizing fix */
  * {
    box-sizing: border-box !important;
    max-width: 100vw !important;
  }

  /* Prevent body scroll when panels are open */
  body.has-open-panel {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
  }

  /* Main app container */
  .music-app {
    width: 100vw !important;
    overflow-x: hidden !important;
    position: relative !important;
    min-height: 100vh !important;
    min-height: -webkit-fill-available !important;
    min-height: 100dvh !important;
  }

  /* Content area adjustments */
  .content-area {
    width: 100% !important;
    padding: 10px !important;
    overflow-x: hidden !important;
  }
}

/* ============================================
   2. SAFE AREA SUPPORT (iPhone X+, iPads)
   ============================================ */

@media (max-width: 768px) {
  /* Base safe area support */
  .music-app {
    padding-left: env(safe-area-inset-left, 0);
    padding-right: env(safe-area-inset-right, 0);
    padding-top: env(safe-area-inset-top, 0);
    padding-bottom: env(safe-area-inset-bottom, 0);
  }

  /* Modern safe area with max() for minimum padding */
  @supports (padding: max(0px)) {
    .panel-container {
      padding-left: max(0px, env(safe-area-inset-left));
      padding-right: max(0px, env(safe-area-inset-right));
      padding-top: max(0px, env(safe-area-inset-top));
      padding-bottom: max(0px, env(safe-area-inset-bottom));
    }

    .panel-header {
      padding-top: max(16px, calc(16px + env(safe-area-inset-top)));
    }

    .panel-content {
      padding-bottom: max(20px, calc(20px + env(safe-area-inset-bottom)));
    }
  }

  /* Landscape orientation safe areas */
  @media (orientation: landscape) {
    .panel-container {
      padding-left: calc(20px + env(safe-area-inset-left, 0));
      padding-right: calc(20px + env(safe-area-inset-right, 0));
    }
  }
}

/* ============================================
   3. PANEL LAYOUT & STRUCTURE
   ============================================ */

@media (max-width: 768px) {
  /* Panel containers base styles */
  .panel-container {
    position: fixed !important;
    width: 100vw !important;
    height: 100vh !important;
    height: -webkit-fill-available !important;
    height: 100dvh !important;
    max-width: 100vw !important;
    left: 0 !important;
    right: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    z-index: 1300 !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    background: var(--panel-bg, white);
    box-sizing: border-box !important;
  }

  /* Panel overlay for background dimming */
  .panel-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1299;
    display: none;
  }

  .music-app.has-service-panel .panel-overlay,
  .music-app.has-user-panel .panel-overlay,
  .music-app.has-settings-panel .panel-overlay,
  .music-app.has-audit-log-panel .panel-overlay {
    display: block;
  }

  /* Panel headers */
  .panel-header,
  .service-panel-header,
  .settings-header,
  .user-panel-header,
  .audit-log-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 10 !important;
    background: inherit !important;
    padding: 16px 20px !important;
    padding-top: calc(16px + env(safe-area-inset-top, 0)) !important;
    padding-left: calc(20px + env(safe-area-inset-left, 0)) !important;
    padding-right: calc(20px + env(safe-area-inset-right, 0)) !important;
    box-sizing: border-box !important;
  }

  /* Panel content areas */
  .panel-content,
  .service-panel-content,
  .settings-content,
  .user-panel-content,
  .audit-log-content {
    padding: 20px !important;
    padding-left: calc(20px + env(safe-area-inset-left, 0)) !important;
    padding-right: calc(20px + env(safe-area-inset-right, 0)) !important;
    padding-bottom: calc(20px + env(safe-area-inset-bottom, 0)) !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    height: calc(100% - 60px) !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-y: contain !important;
  }

  /* Disable resize handles on mobile */
  .resize-handle {
    display: none !important;
  }
}

/* ============================================
   4. SWIPEABLE PANEL SUPPORT
   ============================================ */

@media (max-width: 768px) {
  /* Swipeable wrapper */
  .swipeable-panel-wrapper {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 1300 !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Swipe handle indicator */
  .swipe-handle {
    width: 40px;
    height: 4px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 2px;
    margin: 8px auto;
    transition: background 0.2s;
  }

  .swipe-handle:active {
    background: rgba(0, 0, 0, 0.4);
  }

  /* Swipeable tabs container */
  .swipeable-tabs-container {
    display: flex !important;
    transition: transform 0.3s ease-out !important;
    will-change: transform !important;
  }

  .swipeable-tab-panel {
    width: 100vw !important;
    flex-shrink: 0 !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
  }

  /* Smooth swipe transitions */
  .swipeable-tabs-container.swiping {
    transition: none !important;
  }
}

/* ============================================
   5. BUTTON & CONTROL FIXES
   ============================================ */

@media (max-width: 768px) {
  /* Fix MUI button sizes on mobile */
  .MuiButton-root {
    min-height: 48px !important;
    font-size: 16px !important;
    touch-action: manipulation !important;
  }

  .MuiIconButton-root {
    min-width: 48px !important;
    min-height: 48px !important;
    touch-action: manipulation !important;
  }

  /* Service control buttons */
  .service-controls {
    display: flex !important;
    gap: 8px !important;
    padding: 8px 0 !important;
  }

  .service-controls button {
    flex: 1 !important;
    min-height: 44px !important;
  }

  /* Prevent button text selection */
  button, .MuiButton-root, .MuiIconButton-root {
    -webkit-user-select: none !important;
    -webkit-touch-callout: none !important;
    user-select: none !important;
  }

  /* Fix for iOS button appearance */
  button, input, select, textarea {
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    border-radius: 4px;
  }
}

/* ============================================
   6. FORM CONTROLS & INPUTS
   ============================================ */

@media (max-width: 768px) {
  /* Form control sizing */
  .MuiTextField-root,
  .MuiSelect-root,
  .MuiFormControl-root {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  /* Input field sizing for better touch targets */
  .MuiInputBase-root {
    min-height: 48px !important;
    font-size: 16px !important; /* Prevents zoom on iOS */
  }

  /* Select dropdowns */
  .MuiSelect-select {
    padding: 12px 32px 12px 12px !important;
  }

  /* Text areas */
  textarea {
    font-size: 16px !important;
    line-height: 1.5 !important;
  }

  /* Disable input zoom on iOS */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="url"],
  select,
  textarea {
    font-size: 16px !important;
  }
}

/* ============================================
   7. TABLE & DATA DISPLAY
   ============================================ */

@media (max-width: 768px) {
  /* Table containers */
  .MuiTableContainer-root {
    max-width: 100% !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* Table cells */
  .MuiTableCell-root {
    padding: 8px !important;
    font-size: 14px !important;
  }

  /* Data grid adjustments */
  .MuiDataGrid-root {
    font-size: 14px !important;
  }

  .MuiDataGrid-cell {
    padding: 8px !important;
  }
}

/* ============================================
   8. iOS SPECIFIC FIXES
   ============================================ */

@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    /* iOS scroll behavior */
    .panel-container,
    .panel-content {
      -webkit-overflow-scrolling: touch !important;
      overscroll-behavior: contain !important;
    }

    /* Prevent rubber band scrolling horizontally */
    * {
      overscroll-behavior-x: none !important;
    }

    /* Fix for iOS keyboard */
    .music-app {
      position: fixed !important;
      width: 100% !important;
      height: 100% !important;
    }

    /* iOS tap highlight */
    * {
      -webkit-tap-highlight-color: transparent !important;
    }

    /* Fix iOS momentum scrolling */
    .scrollable-content {
      -webkit-overflow-scrolling: touch !important;
      overflow-y: scroll !important;
      will-change: scroll-position !important;
    }

    /* iOS input focus fix */
    input:focus,
    textarea:focus,
    select:focus {
      outline: none !important;
      border-color: var(--primary-color, #2196f3) !important;
    }
  }
}

/* ============================================
   9. iPAD SPECIFIC ADJUSTMENTS
   ============================================ */

@media (min-width: 769px) and (max-width: 1024px) {
  /* iPad portrait */
  .panel-container {
    width: 70vw !important;
    max-width: 600px !important;
    left: auto !important;
    right: 0 !important;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1) !important;
  }

  /* iPad landscape */
  @media (orientation: landscape) {
    .panel-container {
      width: 50vw !important;
      max-width: 500px !important;
    }

    /* Split view for iPad landscape */
    .music-app.has-panel-open .content-area {
      margin-right: 50vw !important;
    }
  }

  /* iPad Pro adjustments */
  @media (min-width: 1024px) {
    .panel-container {
      width: 40vw !important;
      max-width: 450px !important;
    }
  }
}

/* ============================================
   10. ANIMATION & TRANSITIONS
   ============================================ */

@media (max-width: 768px) {
  /* Panel slide animations */
  .panel-container {
    transform: translateX(100%);
    transition: transform 0.3s ease-out;
  }

  .panel-container.open {
    transform: translateX(0);
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .panel-container,
    .swipeable-tabs-container {
      transition: none !important;
    }
  }
}

/* ============================================
   11. MODAL & OVERLAY ADJUSTMENTS
   ============================================ */

@media (max-width: 768px) {
  /* Modal positioning */
  .MuiModal-root .MuiBox-root {
    margin: 16px !important;
    max-height: calc(100vh - 32px) !important;
    overflow-y: auto !important;
  }

  /* Modal backdrop */
  .MuiBackdrop-root {
    background-color: rgba(0, 0, 0, 0.5) !important;
  }

  /* Dialog adjustments */
  .MuiDialog-paper {
    margin: 16px !important;
    width: calc(100% - 32px) !important;
    max-width: calc(100vw - 32px) !important;
  }
}

/* ============================================
   12. PERFORMANCE OPTIMIZATIONS
   ============================================ */

@media (max-width: 768px) {
  /* Use GPU acceleration for animations */
  .panel-container,
  .swipeable-tabs-container {
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* Optimize touch responsiveness */
  * {
    touch-action: pan-y;
  }

  .swipeable-tabs-container {
    touch-action: pan-x pan-y;
  }

  /* Reduce paint areas */
  .panel-header {
    contain: layout style;
  }
}
