/* ========================================================================
   BACKGROUND IMAGE FIX
   ========================================================================
   Löst das Problem des verschwindenden Hintergrundbilds beim Öffnen von Panels
   ======================================================================== */

/* Sicherstellen, dass das Hintergrundbild IMMER sichtbar bleibt */
.background-image {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: -10 !important; /* Sehr niedrig, damit es hinter allem ist */
  pointer-events: none !important;
  isolation: isolate; /* Erstellt neuen Stacking Context */
}

.background-overlay {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: -9 !important; /* Über dem Bild, aber unter allem anderen */
  pointer-events: none !important;
}

/* Root-Container muss relativen z-index haben */
#root {
  position: relative;
  z-index: 0;
  isolation: isolate;
}

/* Music-App Container */
.music-app {
  position: relative;
  z-index: 1;
  min-height: 100vh;
}

/* Wenn Panels geöffnet sind, darf das nicht das Background beeinflussen */
.music-app.has-service-panel,
.music-app.has-settings-panel,
.music-app.has-user-panel,
.music-app.has-audit-log-panel {
  /* Keine Änderungen am z-index oder background */
}

/* Panels müssen über dem Content sein, aber nicht das Background beeinflussen */
.panel-container {
  position: fixed; /* Fixed statt relative */
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 1000; /* Hoch genug für Panels */
  pointer-events: auto;
}

/* Sicherstellen, dass keine CSS-Regel das Background-Element versteckt */
body:not(.no-background) .background-image,
.has-background-image .background-image {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important; /* Die tatsächliche Opacity wird inline gesetzt */
}

/* Verhindere, dass andere Elemente den Background überdecken */
.main-content,
.content-body {
  position: relative;
  z-index: 10; /* Über dem Background, aber unter den Panels */
  background: transparent !important;
}

/* Sidebar z-index */
.sidebar {
  position: relative;
  z-index: 100; /* Über dem Content, aber unter den Panels */
}

/* Debug-Hilfe: Zeige immer einen roten Rand um das Background-Element */
.debug-background .background-image {
  border: 5px solid red !important;
}

/* Vermeide transform auf Eltern-Elementen, die den Stacking Context brechen könnten */
.music-app,
.main-content,
.content-body,
#root {
  transform: none !important;
  will-change: auto !important;
}
