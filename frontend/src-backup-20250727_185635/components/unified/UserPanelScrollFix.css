/* Mobile Scroll Fix for User Panel */

@media (max-width: 768px) {
  /* Main panel container must be scrollable */
  .user-panel-container .MuiBox-root[style*='height: 100%'] {
    height: 100vh !important;
    height: 100dvh !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Content area must be scrollable */
  .MuiBox-root[style*='flex: 1'][style*='overflow: auto'] {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    min-height: 0 !important; /* Critical for flex children */
    height: auto !important;
    touch-action: pan-y !important;
  }

  /* Tab panels need proper height */
  div[role="tabpanel"] {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    min-height: 0 !important;
  }

  /* Content inside tab panels must be scrollable */
  div[role="tabpanel"] > .MuiBox-root {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    min-height: 0 !important;
    padding-bottom: env(safe-area-inset-bottom, 20px) !important;
  }

  /* Prevent body scroll lock - only lock background, not panel content */
  body.has-user-panel {
    position: fixed !important;
    width: 100% !important;
    overflow: hidden !important;
  }

  /* But ensure panel itself can scroll */
  .user-panel-container {
    position: fixed !important;
    top: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    left: 0 !important;
    z-index: 1300 !important;
    overflow: hidden !important;
  }

  /* Header should not scroll */
  .user-panel-container > .MuiBox-root > .MuiBox-root:first-child {
    flex-shrink: 0 !important;
  }

  /* Tabs should not scroll */
  .user-panel-container .MuiTabs-root {
    flex-shrink: 0 !important;
  }

  /* Fix for iOS momentum scrolling */
  .MuiBox-root[style*='overflow: auto'] {
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-y: contain !important;
  }

  /* Ensure content doesn't get cut off */
  .MuiBox-root[style*='overflow: auto'] > * {
    padding-bottom: 100px !important; /* Extra space at bottom */
  }
}

/* Debug helpers - uncomment to visualize scroll containers */
/*
@media (max-width: 768px) {
  .MuiBox-root[style*='overflow: auto'] {
    border: 3px solid red !important;
  }
  
  div[role="tabpanel"] {
    border: 3px solid green !important;
  }
  
  .user-panel-container {
    border: 3px solid blue !important;
  }
}
*/

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    /* Fix iOS scroll issues */
    .MuiBox-root[style*='overflow: auto'] {
      position: relative !important;
      -webkit-transform: translateZ(0) !important;
      transform: translateZ(0) !important;
    }

    /* Prevent iOS bounce on non-scrollable elements */
    .user-panel-container > .MuiBox-root {
      overscroll-behavior: none !important;
    }

    /* Allow bounce only on scrollable content */
    .MuiBox-root[style*='overflow: auto'] {
      overscroll-behavior-y: auto !important;
      overscroll-behavior-x: none !important;
    }
  }
}

/* Fix for Android */
@media (max-width: 768px) {
  /* Ensure proper touch handling */
  .MuiBox-root[style*='overflow: auto'] {
    touch-action: pan-y !important;
  }

  /* Prevent horizontal pan */
  * {
    touch-action: pan-y pinch-zoom !important;
  }
}
