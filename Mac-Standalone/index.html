<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Docker Management - Web Appliance Dashboard</title>
    <link rel="stylesheet" href="src/styles.css">
    <link rel="stylesheet" href="src/docker-management/docker-styles.css">
    <style>
        /* Inline Log Enhancement Styles */
        .log-filter-controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        .filter-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: #e0e0e0;
            font-size: 0.875rem;
        }
        
        .filter-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .filter-dot.note { background: #4ecdc4; }
        .filter-dot.warning { background: #ff9800; }
        .filter-dot.error { background: #f44336; }
        
        .log-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-left: auto;
        }
        
        .btn-save {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .btn-save:hover {
            background: #45b7aa;
            transform: translateY(-1px);
        }
        
        .auto-refresh-status {
            color: #4ecdc4;
            font-size: 0.75rem;
        }
        
        .log-stats {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.75rem;
            color: #a0a0a0;
            display: flex;
            gap: 1rem;
        }
        
        /* Text filter styles */
        .text-filter-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            padding: 0.75rem;
            background: rgba(255,255,255,0.03);
            border-radius: 6px;
            margin-left: 1rem;
        }
        
        .text-filter-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }
        
        .toggle-switch {
            width: 40px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            position: relative;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #4ecdc4;
        }
        
        .toggle-slider {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }
        
        .text-filter-input {
            background: var(--docker-bg, #1a1a1a);
            color: var(--docker-text, #e0e0e0);
            border: 1px solid var(--docker-border, #333);
            border-radius: 4px;
            padding: 0.4rem 0.8rem;
            font-size: 0.875rem;
            width: 250px;
            transition: all 0.2s;
        }
        
        .text-filter-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
        }
        
        .text-filter-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .text-filter-label {
            font-size: 0.75rem;
            color: #a0a0a0;
        }
        
        /* Log line styles */
        .log-line {
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }
        
        .log-line.error { color: #f44336; }
        .log-line.warning { color: #ff9800; }
        .log-line.note { color: #4ecdc4; }
        
        /* Custom Scrollbar Styles for Dark Theme */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 6px;
            border: 2px solid #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        ::-webkit-scrollbar-thumb:active {
            background: #666;
        }
        
        /* Firefox Scrollbar Support */
        * {
            scrollbar-width: thin;
            scrollbar-color: #444 #1a1a1a;
        }
        
        /* Specific scrollbar for logs output */
        .logs-output::-webkit-scrollbar-track {
            background: #0d0d0d;
        }
        
        .logs-output::-webkit-scrollbar-thumb {
            background: #333;
            border: 1px solid #0d0d0d;
        }
        
        .logs-output::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body class="docker-management">
    <!-- Setup Overlay removed - not needed for Docker Management -->

    <div class="docker-container">
        <!-- Modern Docker Header -->
        <div class="docker-header">
            <h1>
                <svg class="docker-icon" viewBox="0 0 24 24">
                    <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
                </svg>
                Docker Management
            </h1>
            <div class="subtitle">Web Appliance Dashboard Container-Verwaltung</div>
        </div>
        
        <div class="docker-content">
            <!-- Container Control -->
            <div class="docker-section">
                <h2>
                    <svg class="docker-icon" width="20" height="20" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Container-Steuerung
                </h2>
                <div class="controls" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button id="startBtn" class="docker-btn btn-success">
                        <svg viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm0-1A7 7 0 1 1 8 1a7 7 0 0 1 0 14z"/>
                        </svg>
                        Starten
                    </button>
                    <button id="stopBtn" class="docker-btn btn-danger">
                        <svg viewBox="0 0 16 16">
                            <path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"/>
                        </svg>
                        Stoppen
                    </button>
                    <button id="restartBtn" class="docker-btn btn-warning">
                        <svg viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Neustarten
                    </button>
                </div>
                
                <!-- Status -->
                <div id="statusIndicator" class="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Pr√ºfe Status...</span>
                </div>
            </div>

            <!-- Container List -->
            <div class="docker-section">
                <h2>
                    <svg class="docker-icon" width="20" height="20" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                    Container Status
                </h2>
                <div id="containerList" class="container-list">
                    <div class="loading">Container werden geladen...</div>
                </div>
            </div>

            <!-- Logs with Enhanced Features -->
            <div class="container-logs">
                <h2>Container Logs</h2>
                
                <!-- New Filter Controls -->
                <div class="log-filter-controls">
                    <div class="filter-group">
                        <span style="color: #a0a0a0; font-size: 0.875rem;">Filter:</span>
                        <label class="filter-label">
                            <input type="checkbox" id="filterNote" checked>
                            <span class="filter-dot note"></span>
                            <span>Note</span>
                        </label>
                        <label class="filter-label">
                            <input type="checkbox" id="filterWarning" checked>
                            <span class="filter-dot warning"></span>
                            <span>Warning</span>
                        </label>
                        <label class="filter-label">
                            <input type="checkbox" id="filterError" checked>
                            <span class="filter-dot error"></span>
                            <span>Error</span>
                        </label>
                    </div>
                    <div class="text-filter-container">
                        <label class="text-filter-toggle">
                            <div class="toggle-switch" id="textFilterToggle">
                                <div class="toggle-slider"></div>
                            </div>
                            <span class="text-filter-label">W√∂rter ausblenden:</span>
                        </label>
                        <input 
                            type="text" 
                            id="textFilterInput" 
                            class="text-filter-input" 
                            placeholder="W√∂rter mit Leerzeichen trennen"
                            disabled
                        >
                    </div>
                    <div class="log-actions">
                        <button id="saveLogsBtn" class="btn-save">
                            üíæ Log speichern
                        </button>
                        <span class="auto-refresh-status">
                            Auto-Refresh: <span id="refreshCountdown">5</span>s
                        </span>
                    </div>
                </div>
                
                <div class="log-controls">
                    <select id="logService">
                        <option value="">Alle Container</option>
                        <option value="database">Database</option>
                        <option value="backend">Backend</option>
                        <option value="webserver">Webserver</option>
                        <option value="ttyd">Terminal</option>
                    </select>
                    <button id="refreshLogsBtn" class="docker-btn">
                        <svg viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Logs aktualisieren
                    </button>
                </div>
                <div id="logsOutput" class="logs-output">
                    <div class="loading">Logs werden geladen...</div>
                </div>
                <div class="log-stats">
                    <span>Max. 500 Zeilen</span>
                    <span id="logLineCount">0 Zeilen geladen</span>
                </div>
            </div>
        </div>
    </div>

    <script src="src/renderer.js"></script>
    <script>
        // Enhanced Log Features - Fixed Version
        (function() {
            'use strict';
            
            console.log('Docker Management: Enhanced logs starting...');
            
            let autoRefreshCountdown = 5;
            let logLines = [];
            let originalRefreshLogs = null;
            let textFilterEnabled = false;
            let textFilterWords = [];
            
            // Wait for DOM and renderer.js to be ready
            function initEnhancedLogs() {
                console.log('Initializing enhanced logs...');
                
                // Find the refresh logs function
                const refreshBtn = document.getElementById('refreshLogsBtn');
                if (!refreshBtn) {
                    console.error('Refresh button not found');
                    return;
                }
                
                // Get the logsOutput element
                const logsOutput = document.getElementById('logsOutput');
                if (!logsOutput) {
                    console.error('Logs output element not found');
                    return;
                }
                
                // Store the original refreshLogs function
                if (window.refreshLogs && typeof window.refreshLogs === 'function') {
                    originalRefreshLogs = window.refreshLogs;
                    console.log('Found global refreshLogs function');
                }
                
                // Override the global refreshLogs function
                window.refreshLogs = async function() {
                    console.log('Enhanced refreshLogs called');
                    try {
                        const logService = document.getElementById('logService');
                        const result = await window.electronAPI.docker.getLogs(logService ? logService.value : '');
                        
                        if (result.logs) {
                            console.log('Logs received, length:', result.logs.length);
                            // Process and display the logs with our enhancements
                            processAndDisplayLogs(result.logs);
                        } else if (result.error) {
                            logsOutput.textContent = 'Fehler beim Abrufen der Logs: ' + result.error;
                        }
                    } catch (error) {
                        console.error('Error in enhanced refreshLogs:', error);
                        logsOutput.textContent = 'Fehler: ' + error.message;
                    }
                };
                
                // Replace the click handler
                refreshBtn.onclick = window.refreshLogs;
                
                // Setup auto-refresh
                setupAutoRefresh();
                
                // Setup filters
                setupFilters();
                
                // Setup text filter
                setupTextFilter();
                
                // Setup save button
                setupSaveButton();
                
                // Initial load
                setTimeout(() => {
                    console.log('Triggering initial refresh');
                    window.refreshLogs();
                }, 1000);
            }
            
            function processAndDisplayLogs(rawLogs) {
                const logsOutput = document.getElementById('logsOutput');
                if (!logsOutput) return;
                
                // Split into lines and process
                const lines = rawLogs
                    .split('\n')
                    .map(line => {
                        // Trim whitespace and remove any non-printable characters
                        const cleaned = line.trim().replace(/[\x00-\x1F\x7F-\x9F]/g, '');
                        return cleaned;
                    })
                    .filter(line => {
                        // Remove empty lines and lines that only contain whitespace or special characters
                        if (!line || line.length === 0) return false;
                        // Also remove lines that are just dots or dashes
                        if (/^[\.\-\s]+$/.test(line)) return false;
                        // Remove lines that look like the wavy patterns (repetitive characters)
                        if (/^[~_\-\/\\]{3,}$/.test(line)) return false;
                        // Remove lines that contain wave-like patterns (the red curves in the screenshot)
                        // These often appear as Unicode box drawing or special characters
                        if (/^[\u2500-\u257F\u2580-\u259F\u25A0-\u25FF]+$/.test(line)) return false;
                        // Remove lines with just spaces and special drawing characters
                        if (/^[\s\u2500-\u25FF\u2800-\u28FF]+$/.test(line)) return false;
                        // Remove lines that are clearly decorative (repeated patterns)
                        if (/^(.)\1{10,}$/.test(line)) return false;
                        // Remove lines that look like ASCII art or decorative patterns
                        // This includes wavy lines made with slashes, underscores, etc.
                        if (/^[\s]*[\/\\_~\-]{2,}[\s\/\\_~\-]*[\/\\_~\-]{2,}[\s]*$/.test(line)) return false;
                        // Remove lines that contain only special characters and spaces
                        if (/^[^a-zA-Z0-9]+$/.test(line) && line.length > 3) return false;
                        return true;
                    });
                    
                logLines = lines.slice(-500);
                
                console.log('Processing', logLines.length, 'log lines (cleaned)');
                
                // Update line count
                updateLineCount();
                
                // Display with filters and colors
                displayFilteredLogs();
            }
            
            function displayFilteredLogs() {
                const logsOutput = document.getElementById('logsOutput');
                if (!logsOutput) return;
                
                const filters = {
                    note: document.getElementById('filterNote')?.checked ?? true,
                    warning: document.getElementById('filterWarning')?.checked ?? true,
                    error: document.getElementById('filterError')?.checked ?? true
                };
                
                console.log('Filter states:', filters);
                console.log('Text filter enabled:', textFilterEnabled, 'Words:', textFilterWords);
                
                // Clear the output first
                logsOutput.innerHTML = '';
                
                // Filter lines
                const filteredLines = [];
                
                for (let i = 0; i < logLines.length; i++) {
                    const line = logLines[i];
                    if (!line || line.trim() === '') continue; // Skip empty lines
                    
                    const lower = line.toLowerCase();
                    
                    // First apply text filter if enabled
                    if (textFilterEnabled && textFilterWords.length > 0) {
                        // Check if any of the filter words appear in the line
                        const containsFilterWord = textFilterWords.some(word => 
                            lower.includes(word.toLowerCase())
                        );
                        if (containsFilterWord) {
                            continue; // Skip this line
                        }
                    }
                    
                    // Then apply category filters
                    let category = 'note'; // default
                    
                    // Check for error patterns
                    if (lower.includes('error') || lower.includes('fail') || lower.includes('‚ùå')) {
                        category = 'error';
                        if (!filters.error) continue; // Skip if error filter is off
                    }
                    // Check for warning patterns
                    else if (lower.includes('warn') || lower.includes('warning')) {
                        category = 'warning';
                        if (!filters.warning) continue; // Skip if warning filter is off
                    }
                    // Check for note/info patterns
                    else if (lower.includes('info') || lower.includes('note') || 
                             lower.includes('checking status') || lower.includes('‚óè') ||
                             lower.includes('üîç') || lower.includes('üìã')) {
                        category = 'note';
                        if (!filters.note) continue; // Skip if note filter is off
                    }
                    // Default: treat as note/info
                    else {
                        if (!filters.note) continue; // Skip if note filter is off
                    }
                    
                    // Add to filtered lines
                    filteredLines.push({ line, category });
                }
                
                console.log('Filtered', logLines.length, 'lines to', filteredLines.length);
                
                // If no lines match the filter, show a message
                if (filteredLines.length === 0) {
                    logsOutput.innerHTML = '<div style="color: #666; padding: 1rem; text-align: center;">Keine Logs entsprechen den aktuellen Filterkriterien</div>';
                    const lineCountEl = document.getElementById('logLineCount');
                    if (lineCountEl) {
                        lineCountEl.textContent = `0 von ${logLines.length} Zeilen angezeigt`;
                    }
                    return;
                }
                
                // Create a container for the logs
                const container = document.createElement('div');
                container.style.cssText = 'font-family: monospace;';
                
                // Add each filtered line as a separate div
                filteredLines.forEach(({ line, category }) => {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = `log-line ${category}`;
                    lineDiv.textContent = line;
                    container.appendChild(lineDiv);
                });
                
                logsOutput.appendChild(container);
                
                // Update count
                const lineCountEl = document.getElementById('logLineCount');
                if (lineCountEl) {
                    lineCountEl.textContent = `${filteredLines.length} von ${logLines.length} Zeilen angezeigt`;
                }
                
                // Scroll to bottom
                logsOutput.scrollTop = logsOutput.scrollHeight;
            }
            
            function updateLineCount() {
                const lineCountEl = document.getElementById('logLineCount');
                if (lineCountEl) {
                    lineCountEl.textContent = `${logLines.length} Zeilen geladen`;
                }
            }
            
            function setupAutoRefresh() {
                setInterval(() => {
                    autoRefreshCountdown--;
                    const countdownEl = document.getElementById('refreshCountdown');
                    if (countdownEl) {
                        countdownEl.textContent = autoRefreshCountdown;
                    }
                    
                    if (autoRefreshCountdown <= 0) {
                        autoRefreshCountdown = 5;
                        if (window.refreshLogs) {
                            window.refreshLogs();
                        }
                    }
                }, 1000);
            }
            
            function setupFilters() {
                ['filterNote', 'filterWarning', 'filterError'].forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.addEventListener('change', displayFilteredLogs);
                    }
                });
            }
            
            function setupTextFilter() {
                const toggle = document.getElementById('textFilterToggle');
                const input = document.getElementById('textFilterInput');
                
                if (!toggle || !input) return;
                
                // Toggle button click handler
                toggle.addEventListener('click', () => {
                    textFilterEnabled = !textFilterEnabled;
                    toggle.classList.toggle('active', textFilterEnabled);
                    input.disabled = !textFilterEnabled;
                    
                    if (textFilterEnabled) {
                        input.focus();
                    }
                    
                    // Apply filter immediately
                    displayFilteredLogs();
                });
                
                // Input change handler with debounce
                let debounceTimer;
                input.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        const value = e.target.value.trim();
                        if (value) {
                            // Split by spaces and filter out empty strings
                            textFilterWords = value.split(/\s+/).filter(word => word.length > 0);
                        } else {
                            textFilterWords = [];
                        }
                        
                        console.log('Text filter words updated:', textFilterWords);
                        
                        // Apply filter
                        if (textFilterEnabled) {
                            displayFilteredLogs();
                        }
                    }, 300); // 300ms debounce
                });
                
                // Enter key handler for immediate apply
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        clearTimeout(debounceTimer);
                        const value = e.target.value.trim();
                        if (value) {
                            textFilterWords = value.split(/\s+/).filter(word => word.length > 0);
                        } else {
                            textFilterWords = [];
                        }
                        
                        if (textFilterEnabled) {
                            displayFilteredLogs();
                        }
                    }
                });
            }
            
            function setupSaveButton() {
                const saveBtn = document.getElementById('saveLogsBtn');
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                        const filename = `docker-logs-${timestamp}.txt`;
                        
                        // Get currently filtered lines
                        const filteredLines = getFilteredLines();
                        const content = filteredLines.join('\n') || 'Keine Logs vorhanden';
                        
                        // Add header with filter information
                        let header = `Docker Logs - ${new Date().toLocaleString()}\n`;
                        header += `Gefiltert: ${filteredLines.length} von ${logLines.length} Zeilen\n`;
                        
                        // Add active filters info
                        const filters = [];
                        if (!document.getElementById('filterNote')?.checked) filters.push('Note ausgeblendet');
                        if (!document.getElementById('filterWarning')?.checked) filters.push('Warning ausgeblendet');
                        if (!document.getElementById('filterError')?.checked) filters.push('Error ausgeblendet');
                        
                        if (textFilterEnabled && textFilterWords.length > 0) {
                            filters.push(`Textfilter: "${textFilterWords.join(' ')}"`);
                        }
                        
                        if (filters.length > 0) {
                            header += `Aktive Filter: ${filters.join(', ')}\n`;
                        }
                        
                        header += '='.repeat(80) + '\n\n';
                        
                        const fullContent = header + content;
                        
                        const blob = new Blob([fullContent], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        // Visual feedback
                        const originalText = saveBtn.textContent;
                        saveBtn.textContent = '‚úÖ Gespeichert!';
                        saveBtn.style.background = '#4caf50';
                        
                        setTimeout(() => {
                            saveBtn.textContent = originalText;
                            saveBtn.style.background = '';
                        }, 2000);
                    });
                }
            }
            
            function getFilteredLines() {
                const filters = {
                    note: document.getElementById('filterNote')?.checked ?? true,
                    warning: document.getElementById('filterWarning')?.checked ?? true,
                    error: document.getElementById('filterError')?.checked ?? true
                };
                
                const filtered = [];
                
                for (let i = 0; i < logLines.length; i++) {
                    const line = logLines[i];
                    if (!line || line.trim() === '') continue;
                    
                    // Additional cleaning for save - remove lines that look like decorative elements
                    const cleanedLine = line.trim();
                    if (/^[\.\-\s]+$/.test(cleanedLine)) continue;
                    if (/^[~_\-\/\\]{3,}$/.test(cleanedLine)) continue;
                    // Remove wave patterns and decorative lines
                    if (/^[\u2500-\u257F\u2580-\u259F\u25A0-\u25FF]+$/.test(cleanedLine)) continue;
                    if (/^[\s\u2500-\u25FF\u2800-\u28FF]+$/.test(cleanedLine)) continue;
                    if (/^(.)\1{10,}$/.test(cleanedLine)) continue;
                    // Remove ASCII art patterns
                    if (/^[\s]*[\/\\_~\-]{2,}[\s\/\\_~\-]*[\/\\_~\-]{2,}[\s]*$/.test(cleanedLine)) continue;
                    if (/^[^a-zA-Z0-9]+$/.test(cleanedLine) && cleanedLine.length > 3) continue;
                    
                    const lower = line.toLowerCase();
                    
                    // First apply text filter if enabled
                    if (textFilterEnabled && textFilterWords.length > 0) {
                        const containsFilterWord = textFilterWords.some(word => 
                            lower.includes(word.toLowerCase())
                        );
                        if (containsFilterWord) {
                            continue;
                        }
                    }
                    
                    // Then apply category filters
                    if (lower.includes('error') || lower.includes('fail') || lower.includes('‚ùå')) {
                        if (!filters.error) continue;
                    } else if (lower.includes('warn') || lower.includes('warning')) {
                        if (!filters.warning) continue;
                    } else {
                        // Everything else is treated as note
                        if (!filters.note) continue;
                    }
                    
                    filtered.push(line);
                }
                
                return filtered;
            }
            
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initEnhancedLogs);
            } else {
                // Small delay to ensure renderer.js is loaded
                setTimeout(initEnhancedLogs, 500);
            }
        })();
    </script>
</body>
</html>